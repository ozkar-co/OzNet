<article>
    <header>
        <h1>Explorador de Archivos</h1>
        <p>Navega por los archivos y directorios de OzNet</p>
    </header>

    <section>
        <div class="breadcrumb">
            {{#each breadcrumbs}}
                <a href="/?path={{encodeURIComponent path}}">{{name}}</a>
                {{#unless @last}}
                    <span class="breadcrumb-separator">/</span>
                {{/unless}}
            {{/each}}
        </div>
    </section>

    <section>
        <div class="file-list">
            {{#if files.length}}
                {{#each files}}
                <div class="file-item">
                    <div class="file-icon">
                        {{#if isDirectory}}
                            <span class="directory-icon">üìÅ</span>
                        {{else}}
                            {{#if (eq (getFileIcon name false) 'üñºÔ∏è')}}
                                <span class="image-icon">üñºÔ∏è</span>
                            {{else if (eq (getFileIcon name false) 'üì¶')}}
                                <span class="archive-icon">üì¶</span>
                            {{else}}
                                <span class="document-icon">üìÑ</span>
                            {{/if}}
                        {{/if}}
                    </div>
                    <div class="file-info">
                        <div class="file-name">
                            {{#if isDirectory}}
                                <a href="/?path={{encodeURIComponent path}}">{{name}}</a>
                            {{else}}
                                {{name}}
                            {{/if}}
                        </div>
                        <div class="file-details">
                            {{#if isDirectory}}
                                Directorio
                            {{else}}
                                {{size}} ‚Ä¢ Modificado: {{formatDate modified}}
                            {{/if}}
                        </div>
                    </div>
                    <div class="file-actions">
                        {{#if isDirectory}}
                            <button onclick="window.location.href='/?path={{encodeURIComponent path}}'" class="outline">
                                Abrir
                            </button>
                        {{else}}
                            <button onclick="downloadFile('{{path}}')" class="outline">
                                Descargar
                            </button>
                        {{/if}}
                        <button onclick="getFileInfo('{{path}}')" class="outline">
                            Info
                        </button>
                    </div>
                </div>
                {{/each}}
            {{else}}
                <div class="file-item">
                    <div class="file-info">
                        <div class="file-name">Directorio vac√≠o</div>
                        <div class="file-details">No hay archivos en este directorio</div>
                    </div>
                </div>
            {{/if}}
        </div>
    </section>

    <section>
        <h2>Informaci√≥n del Directorio</h2>
        <div class="grid">
            <div>
                <h4>Ruta Actual</h4>
                <p><code>{{currentPath}}</code></p>
            </div>
            <div>
                <h4>Ruta Relativa</h4>
                <p><code>{{relativePath}}</code></p>
            </div>
            <div>
                <h4>Elementos</h4>
                <p>{{files.length}} elementos</p>
            </div>
        </div>
    </section>

    <section>
        <h2>Acciones</h2>
        <div class="grid">
            <div>
                <button onclick="location.reload()" class="outline">Actualizar</button>
            </div>
            <div>
                <a href="/stats" role="button" class="outline">Ver Estad√≠sticas</a>
            </div>
        </div>
    </section>
</article>

<script>
    // Funci√≥n para obtener icono seg√∫n tipo de archivo
    function getFileIcon(filename, isDirectory) {
        if (isDirectory) return 'üìÅ';
        
        const ext = filename.split('.').pop().toLowerCase();
        const imageExts = ['jpg', 'jpeg', 'png', 'gif', 'svg', 'webp'];
        const documentExts = ['txt', 'md', 'pdf', 'doc', 'docx'];
        const archiveExts = ['zip', 'tar', 'gz', 'rar', '7z'];
        
        if (imageExts.includes(ext)) return 'üñºÔ∏è';
        if (documentExts.includes(ext)) return 'üìÑ';
        if (archiveExts.includes(ext)) return 'üì¶';
        
        return 'üìÑ';
    }

    // Funci√≥n para descargar archivo
    function downloadFile(filePath) {
        window.open(`/download?path=${encodeURIComponent(filePath)}`, '_blank');
    }

    // Funci√≥n para obtener informaci√≥n del archivo
    async function getFileInfo(filePath) {
        try {
            const response = await fetch(`/api/info?path=${encodeURIComponent(filePath)}`);
            const fileInfo = await response.json();
            
            if (fileInfo.error) {
                alert('Error: ' + fileInfo.error);
                return;
            }
            
            const info = `Nombre: ${fileInfo.name}\n` +
                       `Tama√±o: ${fileInfo.size || 'N/A'}\n` +
                       `Modificado: ${new Date(fileInfo.modified).toLocaleString()}\n` +
                       `Permisos: ${fileInfo.permissions}`;
            
            alert(info);
        } catch (error) {
            alert('Error al obtener informaci√≥n del archivo');
        }
    }

    // Atajo de teclado para actualizar (F5)
    document.addEventListener('keydown', function(event) {
        if (event.key === 'F5') {
            event.preventDefault();
            location.reload();
        }
    });
</script> 